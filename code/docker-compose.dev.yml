version: "3.8"

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: pax-backend-dev
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: docker
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/underwriting
      SPRING_DATASOURCE_USERNAME: pax_user
      SPRING_DATASOURCE_PASSWORD: pax_password
      AI_SERVICE_URL: http://backend-ai:8001
    depends_on:
      - mysql
    networks:
      - pax-network
    restart: unless-stopped
    volumes:
      - ./backend:/app:cached
      - ~/.m2:/root/.m2:cached
    working_dir: /app
    command: ["./mvnw", "spring-boot:run", "-Dspring-boot.run.fork=false"]

networks:
  pax-network:
    external: false
